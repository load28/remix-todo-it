var ht=e=>{throw TypeError(e)};var z=(e,t,s)=>t.has(e)||ht("Cannot "+s);var i=(e,t,s)=>(z(e,t,"read from private field"),s?s.call(e):t.get(e)),p=(e,t,s)=>t.has(e)?ht("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),u=(e,t,s,r)=>(z(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),f=(e,t,s)=>(z(e,t,"access private method"),s);import{a as x,ah as Rt,j as y,L as Ct}from"./components-ALsnrb9_.js";import{S as St,l as S,q as G,r as A,b as wt,t as ot,v as ct,w as Ot,g as xt,x as Et,y as ut,n as mt,u as It}from"./QueryClientProvider-BhapipS7.js";var m,a,_,v,Q,T,C,B,U,j,D,F,E,L,o,P,J,X,Y,Z,$,q,tt,gt,vt,Qt=(vt=class extends St{constructor(t,s){super();p(this,o);p(this,m);p(this,a);p(this,_);p(this,v);p(this,Q);p(this,T);p(this,C);p(this,B);p(this,U);p(this,j);p(this,D);p(this,F);p(this,E);p(this,L,new Set);this.options=s,u(this,m,t),u(this,C,null),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(i(this,a).addObserver(this),lt(i(this,a),this.options)?f(this,o,P).call(this):this.updateResult(),f(this,o,Z).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return et(i(this,a),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return et(i(this,a),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,f(this,o,$).call(this),f(this,o,q).call(this),i(this,a).removeObserver(this)}setOptions(t,s){const r=this.options,l=i(this,a);if(this.options=i(this,m).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof S(this.options.enabled,i(this,a))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");f(this,o,tt).call(this),i(this,a).setOptions(this.options),r._defaulted&&!G(this.options,r)&&i(this,m).getQueryCache().notify({type:"observerOptionsUpdated",query:i(this,a),observer:this});const n=this.hasListeners();n&&dt(i(this,a),l,this.options,r)&&f(this,o,P).call(this),this.updateResult(s),n&&(i(this,a)!==l||S(this.options.enabled,i(this,a))!==S(r.enabled,i(this,a))||A(this.options.staleTime,i(this,a))!==A(r.staleTime,i(this,a)))&&f(this,o,J).call(this);const h=f(this,o,X).call(this);n&&(i(this,a)!==l||S(this.options.enabled,i(this,a))!==S(r.enabled,i(this,a))||h!==i(this,E))&&f(this,o,Y).call(this,h)}getOptimisticResult(t){const s=i(this,m).getQueryCache().build(i(this,m),t),r=this.createResult(s,t);return Ft(this,r)&&(u(this,v,r),u(this,T,this.options),u(this,Q,i(this,a).state)),r}getCurrentResult(){return i(this,v)}trackResult(t,s){const r={};return Object.keys(t).forEach(l=>{Object.defineProperty(r,l,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(l),s==null||s(l),t[l])})}),r}trackProp(t){i(this,L).add(t)}getCurrentQuery(){return i(this,a)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const s=i(this,m).defaultQueryOptions(t),r=i(this,m).getQueryCache().build(i(this,m),s);return r.isFetchingOptimistic=!0,r.fetch().then(()=>this.createResult(r,s))}fetch(t){return f(this,o,P).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),i(this,v)))}createResult(t,s){var nt;const r=i(this,a),l=this.options,n=i(this,v),h=i(this,Q),d=i(this,T),w=t!==r?t.state:i(this,_),{state:O}=t;let c={...O},M=!1,g;if(s._optimisticResults){const b=this.hasListeners(),W=!b&&lt(t,s),yt=b&&dt(t,r,s,l);(W||yt)&&(c={...c,...Et(O.data,t.options)}),s._optimisticResults==="isRestoring"&&(c.fetchStatus="idle")}let{error:k,errorUpdatedAt:it,status:I}=c;if(s.select&&c.data!==void 0)if(n&&c.data===(h==null?void 0:h.data)&&s.select===i(this,B))g=i(this,U);else try{u(this,B,s.select),g=s.select(c.data),g=ut(n==null?void 0:n.data,g,s),u(this,U,g),u(this,C,null)}catch(b){u(this,C,b)}else g=c.data;if(s.placeholderData!==void 0&&g===void 0&&I==="pending"){let b;if(n!=null&&n.isPlaceholderData&&s.placeholderData===(d==null?void 0:d.placeholderData))b=n.data;else if(b=typeof s.placeholderData=="function"?s.placeholderData((nt=i(this,j))==null?void 0:nt.state.data,i(this,j)):s.placeholderData,s.select&&b!==void 0)try{b=s.select(b),u(this,C,null)}catch(W){u(this,C,W)}b!==void 0&&(I="success",g=ut(n==null?void 0:n.data,b,s),M=!0)}i(this,C)&&(k=i(this,C),g=i(this,U),it=Date.now(),I="error");const N=c.fetchStatus==="fetching",K=I==="pending",V=I==="error",rt=K&&N,at=g!==void 0;return{status:I,fetchStatus:c.fetchStatus,isPending:K,isSuccess:I==="success",isError:V,isInitialLoading:rt,isLoading:rt,data:g,dataUpdatedAt:c.dataUpdatedAt,error:k,errorUpdatedAt:it,failureCount:c.fetchFailureCount,failureReason:c.fetchFailureReason,errorUpdateCount:c.errorUpdateCount,isFetched:c.dataUpdateCount>0||c.errorUpdateCount>0,isFetchedAfterMount:c.dataUpdateCount>w.dataUpdateCount||c.errorUpdateCount>w.errorUpdateCount,isFetching:N,isRefetching:N&&!K,isLoadingError:V&&!at,isPaused:c.fetchStatus==="paused",isPlaceholderData:M,isRefetchError:V&&at,isStale:st(t,s),refetch:this.refetch}}updateResult(t){const s=i(this,v),r=this.createResult(i(this,a),this.options);if(u(this,Q,i(this,a).state),u(this,T,this.options),i(this,Q).data!==void 0&&u(this,j,i(this,a)),G(r,s))return;u(this,v,r);const l={},n=()=>{if(!s)return!0;const{notifyOnChangeProps:h}=this.options,d=typeof h=="function"?h():h;if(d==="all"||!d&&!i(this,L).size)return!0;const R=new Set(d??i(this,L));return this.options.throwOnError&&R.add("error"),Object.keys(i(this,v)).some(w=>{const O=w;return i(this,v)[O]!==s[O]&&R.has(O)})};(t==null?void 0:t.listeners)!==!1&&n()&&(l.listeners=!0),f(this,o,gt).call(this,{...l,...t})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&f(this,o,Z).call(this)}},m=new WeakMap,a=new WeakMap,_=new WeakMap,v=new WeakMap,Q=new WeakMap,T=new WeakMap,C=new WeakMap,B=new WeakMap,U=new WeakMap,j=new WeakMap,D=new WeakMap,F=new WeakMap,E=new WeakMap,L=new WeakMap,o=new WeakSet,P=function(t){f(this,o,tt).call(this);let s=i(this,a).fetch(this.options,t);return t!=null&&t.throwOnError||(s=s.catch(wt)),s},J=function(){f(this,o,$).call(this);const t=A(this.options.staleTime,i(this,a));if(ot||i(this,v).isStale||!ct(t))return;const r=Ot(i(this,v).dataUpdatedAt,t)+1;u(this,D,setTimeout(()=>{i(this,v).isStale||this.updateResult()},r))},X=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(i(this,a)):this.options.refetchInterval)??!1},Y=function(t){f(this,o,q).call(this),u(this,E,t),!(ot||S(this.options.enabled,i(this,a))===!1||!ct(i(this,E))||i(this,E)===0)&&u(this,F,setInterval(()=>{(this.options.refetchIntervalInBackground||xt.isFocused())&&f(this,o,P).call(this)},i(this,E)))},Z=function(){f(this,o,J).call(this),f(this,o,Y).call(this,f(this,o,X).call(this))},$=function(){i(this,D)&&(clearTimeout(i(this,D)),u(this,D,void 0))},q=function(){i(this,F)&&(clearInterval(i(this,F)),u(this,F,void 0))},tt=function(){const t=i(this,m).getQueryCache().build(i(this,m),this.options);if(t===i(this,a))return;const s=i(this,a);u(this,a,t),u(this,_,t.state),this.hasListeners()&&(s==null||s.removeObserver(this),t.addObserver(this))},gt=function(t){mt.batch(()=>{t.listeners&&this.listeners.forEach(s=>{s(i(this,v))}),i(this,m).getQueryCache().notify({query:i(this,a),type:"observerResultsUpdated"})})},vt);function Dt(e,t){return S(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function lt(e,t){return Dt(e,t)||e.state.data!==void 0&&et(e,t,t.refetchOnMount)}function et(e,t,s){if(S(t.enabled,e)!==!1){const r=typeof s=="function"?s(e):s;return r==="always"||r!==!1&&st(e,t)}return!1}function dt(e,t,s,r){return(e!==t||S(r.enabled,e)===!1)&&(!s.suspense||e.state.status!=="error")&&st(e,s)}function st(e,t){return S(t.enabled,e)!==!1&&e.isStaleByTime(A(t.staleTime,e))}function Ft(e,t){return!G(e.getCurrentResult(),t)}var bt=x.createContext(!1),Tt=()=>x.useContext(bt);bt.Provider;function Ut(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var jt=x.createContext(Ut()),Lt=()=>x.useContext(jt);function Mt(e,t){return typeof e=="function"?e(...t):!!e}var Pt=(e,t)=>{(e.suspense||e.throwOnError)&&(t.isReset()||(e.retryOnMount=!1))},_t=e=>{x.useEffect(()=>{e.clearReset()},[e])},Bt=({result:e,errorResetBoundary:t,throwOnError:s,query:r})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&Mt(s,[e.error,r]),kt=e=>{e.suspense&&(typeof e.staleTime!="number"&&(e.staleTime=1e3),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3)))},At=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,Nt=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()});function Kt(e,t,s){var w,O,c,M;const r=It(s),l=Tt(),n=Lt(),h=r.defaultQueryOptions(e);(O=(w=r.getDefaultOptions().queries)==null?void 0:w._experimental_beforeQuery)==null||O.call(w,h),h._optimisticResults=l?"isRestoring":"optimistic",kt(h),Pt(h,n),_t(n);const[d]=x.useState(()=>new t(r,h)),R=d.getOptimisticResult(h);if(x.useSyncExternalStore(x.useCallback(g=>{const k=l?()=>{}:d.subscribe(mt.batchCalls(g));return d.updateResult(),k},[d,l]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),x.useEffect(()=>{d.setOptions(h,{listeners:!1})},[h,d]),At(h,R))throw Nt(h,d,n);if(Bt({result:R,errorResetBoundary:n,throwOnError:h.throwOnError,query:r.getQueryCache().get(h.queryHash)}))throw R.error;return(M=(c=r.getDefaultOptions().queries)==null?void 0:c._experimental_afterQuery)==null||M.call(c,h,R),h.notifyOnChangeProps?R:d.trackResult(R)}function Vt(e,t){return Kt(e,Qt,t)}const Wt=async()=>new Promise(e=>{setTimeout(async()=>{const t=await fetch("https://pokeapi.co/api/v2/pokemon/ditto");e(await t.json())},0)});var H=new Map,ft={getItem:async e=>H.get(e),setItem:async(e,t)=>H.set(e,t),removeItem:async e=>H.delete(e)},zt=async({request:e,serverLoader:t},{type:s="swr",key:r=pt(e),adapter:l=ft}={type:"swr",key:pt(e),adapter:ft})=>{const n=await l.getItem(r);if(s==="normal"&&n)return{...n,serverData:n,deferredServerData:void 0,key:r};const h=n||await t();await l.setItem(r,h);const d=n?t():void 0;return{...h??n,serverData:h,deferredServerData:d,key:r}},pt=e=>{const t=new URL(e.url);return t.pathname+t.search+t.hash};const Ht=e=>zt(e);Ht.hydrate=!0;function Zt(){const e=Rt(),{data:t,isLoading:s,isSuccess:r}=Vt({queryFn:Wt,queryKey:["news"]});return y.jsxs(y.Fragment,{children:[y.jsx("div",{children:"News"}),s&&y.jsx(y.Fragment,{children:"loading..."}),r&&y.jsxs(y.Fragment,{children:[y.jsx("div",{children:t.name}),y.jsx("div",{children:t.order})]}),y.jsx(Ct,{to:"/news",children:"Client load"}),y.jsx("div",{children:y.jsx("button",{onClick:()=>e("/test"),children:"go test"})})]})}export{Ht as clientLoader,Zt as default};
